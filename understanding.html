<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.31.0">
    <meta name="project" content="Anoma v0.10.0">


    <title>Understanding any code in Anoma — Anoma v0.10.0</title>
    <link rel="stylesheet" href="dist/html-elixir-3ZLIM5JF.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-43PMFBC7.js"></script>
    <script src="dist/sidebar_items-A42A40B0.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-CILPWI2Q.js"></script>


  </head>
  <body data-type="extras" class="page-livemd">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
Anoma
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.10.0
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
GUIDES
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">
      <div class="top-search">
        <div class="search-settings">
          <form class="search-bar" action="search.html">
            <label class="search-label">
              <span class="sr-only">Search documentation of Anoma</span>
              <input name="q" type="text" class="search-input" placeholder="Search Documentation (press /)" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
            </label>
            <button type="submit" class="search-button" aria-label="Submit Search">
              <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
            </button>
            <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
              <i class="ri-close-line ri-lg" title="Cancel search"></i>
            </button>
          </form>
          <button class="icon-settings display-settings">
            <i class="ri-settings-3-line"></i>
            <span class="sr-only">Settings</span>
          </button>
        </div>
      </div>
      <div class="autocomplete">
      </div>

<h1>


  <span>Understanding any code in Anoma</span>
</h1>

  <div class="livebook-badge-container">
    <a href="#" class="livebook-badge">
      <img src="https://livebook.dev/badge/v1/blue.svg" alt="Run in Livebook" width="150" />
    </a>
  </div>

<h2 id="index" class="section-heading">
  <a href="#index" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Index</span>
</h2>
<ul><li><a href="index_docs.html">Index</a><ul><li><a href="contributing.html">Contributing</a><ul><li><a href="understanding.html">Understanding any module</a></li></ul></li></ul></li></ul><h2 id="figuring-out-what-a-module-does" class="section-heading">
  <a href="#figuring-out-what-a-module-does" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Figuring out what a module does</span>
</h2>
<p>Α good start is by calling <code class="inline">h</code> on the module from within one's IEX
instance.</p><pre><code class="makeup elixir" translate="no"><span class="kn">require</span><span class="w"> </span><span class="nc">IEx.Helpers</span><span class="w">
</span><span class="kn">import</span><span class="w"> </span><span class="nc">IEx.Helpers</span><span class="w">
</span><span class="c1"># the above two lines are not requried for the REPL!</span><span class="w">
</span><span class="n">h</span><span class="p" data-group-id="6547099303-1">(</span><span class="nc">Anoma.Node</span><span class="p" data-group-id="6547099303-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="w">
                                   </span><span class="nc">Anoma.Node</span><span class="w">

</span><span class="nc">I</span><span class="w"> </span><span class="n">am</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">supervisor</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nc">Anoma</span><span class="w"> </span><span class="nc">Nodes</span><span class="w">

</span><span class="c1">## Required Arguments</span><span class="w">

  </span><span class="err">•</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">register</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">nodes</span><span class="w">
  </span><span class="err">•</span><span class="w"> </span><span class="n">snapshot_path</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="8745099743-1">[</span><span class="n">atom</span><span class="p" data-group-id="8745099743-2">(</span><span class="p" data-group-id="8745099743-2">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="8745099743-1">]</span><span class="w">
    </span><span class="err">•</span><span class="w"> </span><span class="nc">A</span><span class="w"> </span><span class="n">snapshot</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="p" data-group-id="8745099743-3">(</span><span class="n">used</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">worker</span><span class="p" data-group-id="8745099743-3">)</span><span class="w">

  </span><span class="err">•</span><span class="w"> </span><span class="n">storage</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Anoma.Storage</span><span class="o">.</span><span class="n">t</span><span class="p" data-group-id="8745099743-4">(</span><span class="p" data-group-id="8745099743-4">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nc">The</span><span class="w"> </span><span class="nc">Storage</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="kn">use</span><span class="w">
  </span><span class="err">•</span><span class="w"> </span><span class="n">block_storage</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">blocks</span><span class="w"> </span><span class="n">produced</span><span class="w">
</span><span class="c1">## Optional Arguments</span><span class="w">

  </span><span class="err">•</span><span class="w"> </span><span class="n">jet</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nc">Nock</span><span class="o">.</span><span class="n">jettedness</span><span class="p" data-group-id="8745099743-5">(</span><span class="p" data-group-id="8745099743-5">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">jetted</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w">
  </span><span class="err">•</span><span class="w"> </span><span class="n">old_storage</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">states</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">storage</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">freshly</span><span class="w"> </span><span class="n">made</span><span class="w">
    </span><span class="err">•</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="no">false</span><span class="w">
</span><span class="c1">## Registered names</span><span class="w">



</span><span class="nc">From</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">given</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">derive</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="ss">following</span><span class="p">:</span><span class="w">

  </span><span class="err">•</span><span class="w"> </span><span class="n">name_mempool</span><span class="w">
  </span><span class="err">•</span><span class="w"> </span><span class="n">name_executor</span><span class="w">
  </span><span class="err">•</span><span class="w"> </span><span class="n">name_ordering</span><span class="w">
  </span><span class="err">•</span><span class="w"> </span><span class="n">name_mempool_com</span><span class="w">
  </span><span class="err">•</span><span class="w"> </span><span class="n">name_executor_com</span><span class="w">
  </span><span class="err">•</span><span class="w"> </span><span class="n">name_ordering_com</span><span class="w">

</span><span class="c1">### Created Tables</span><span class="w">

  </span><span class="err">•</span><span class="w"> </span><span class="n">storage</span><span class="o">.</span><span class="n">qualified</span><span class="w">
  </span><span class="err">•</span><span class="w"> </span><span class="n">storage</span><span class="o">.</span><span class="n">order</span><span class="w">
  </span><span class="err">•</span><span class="w"> </span><span class="n">block_storage</span><span class="w">
</span></code></pre><p>However, this typically doesn't show off how one uses said
module. Thankfully, the codebase is setup in such a way that one can
always interactively play with any given module.</p><p>This is done by simply checking out the tests folder, and finding the
module you wish to learn to learn about.</p><p>For example, let us learn about the mempool. In the codebase currently
this can be found here:</p><ul><li><code class="inline">test/node/mempool_test.exs</code>,</li></ul><p>note that even if this gets out of date, you should be able to do this with any file!</p><p>The first thing one can do to run things interactively is by taking
all the imports of the file and running it locally</p><p>In this case I input the following from the file into IEX.</p><p>I also make sure to include an extra <code class="inline">import ExUnit.Assertions</code> so
that assertions can be copied and pasted to IEX</p><pre><code class="makeup elixir" translate="no"><span class="c1"># output redacted for length</span><span class="w">
</span><span class="kn">alias</span><span class="w"> </span><span class="nc">Anoma.Storage</span><span class="w">
</span><span class="kn">alias</span><span class="w"> </span><span class="nc">Anoma.Node.Storage.Communicator</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="nc">Scom</span><span class="w">
</span><span class="kn">alias</span><span class="w"> </span><span class="nc">Anoma.Node.Executor.Communicator</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="nc">Ccom</span><span class="w">
</span><span class="kn">alias</span><span class="w"> </span><span class="nc">Anoma.Node.Mempool.Communicator</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="nc">Mcom</span><span class="w">
</span><span class="kn">import</span><span class="w"> </span><span class="nc">TestHelper.Nock</span><span class="w">

</span><span class="kn">import</span><span class="w"> </span><span class="nc">ExUnit.Assertions</span></code></pre><pre><code class="makeup output" translate="no"><span class="nc">ExUnit.Assertions</span></code></pre><p>After the imports are done, then we copy the <code class="inline">setup_all</code> if this section
exists</p><pre><code class="makeup elixir" translate="no"><span class="c1"># setup_all do</span><span class="w">
</span><span class="n">storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9892088591-1">%</span><span class="nc" data-group-id="9892088591-1">Anoma.Storage</span><span class="p" data-group-id="9892088591-1">{</span><span class="w">
  </span><span class="ss">qualified</span><span class="p">:</span><span class="w"> </span><span class="nc">AnomaTest.Mempool.Qualified</span><span class="p">,</span><span class="w">
  </span><span class="ss">order</span><span class="p">:</span><span class="w"> </span><span class="nc">AnomaTest.Mempool.Order</span><span class="w">
</span><span class="p" data-group-id="9892088591-1">}</span><span class="w">

</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">:mempool</span><span class="w">
</span><span class="n">snapshot_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9892088591-2">[</span><span class="ss">:my_special_nock_snaphsot</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9892088591-2">]</span><span class="w">

</span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Anoma.Node</span><span class="o">.</span><span class="n">com_names</span><span class="p" data-group-id="9892088591-3">(</span><span class="n">name</span><span class="p" data-group-id="9892088591-3">)</span><span class="w">

</span><span class="k">unless</span><span class="w"> </span><span class="nc">Process</span><span class="o">.</span><span class="n">whereis</span><span class="p" data-group-id="9892088591-4">(</span><span class="ss">:mempool_mempool_com</span><span class="p" data-group-id="9892088591-4">)</span><span class="w"> </span><span class="k" data-group-id="9892088591-5">do</span><span class="w">
  </span><span class="nc">Anoma.Node</span><span class="o">.</span><span class="n">start_link</span><span class="p" data-group-id="9892088591-6">(</span><span class="w">
    </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w">
    </span><span class="ss">snapshot_path</span><span class="p">:</span><span class="w"> </span><span class="n">snapshot_path</span><span class="p">,</span><span class="w">
    </span><span class="ss">storage</span><span class="p">:</span><span class="w"> </span><span class="n">storage</span><span class="p">,</span><span class="w">
    </span><span class="ss">block_storage</span><span class="p">:</span><span class="w"> </span><span class="ss">:mempool_blocks</span><span class="w">
  </span><span class="p" data-group-id="9892088591-6">)</span><span class="w">
</span><span class="k" data-group-id="9892088591-5">end</span><span class="w">

</span><span class="n">node</span><span class="w">
</span><span class="c1"># end</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="3118395527-1">%</span><span class="nc" data-group-id="3118395527-1">Anoma.Node</span><span class="p" data-group-id="3118395527-1">{</span><span class="w">
  </span><span class="ss">executor</span><span class="p">:</span><span class="w"> </span><span class="ss">:mempool_executor_com</span><span class="p">,</span><span class="w">
  </span><span class="ss">ordering</span><span class="p">:</span><span class="w"> </span><span class="ss">:mempool_ordering_com</span><span class="p">,</span><span class="w">
  </span><span class="ss">mempool</span><span class="p">:</span><span class="w"> </span><span class="ss">:mempool_mempool_com</span><span class="w">
</span><span class="p" data-group-id="3118395527-1">}</span></code></pre><p>From here we can run any tests in the file by copying those as well!</p><p>What is even better is that we can copy parts of tests to setup an
area to play with the code to figure out what is going well with our
other tools.</p><p>This is a great way for learning any API in the codebase as you can
get hands on what each function and message does.</p><pre><code class="makeup elixir" translate="no"><span class="c1"># test &quot;successful process&quot;, %{node: node} do</span><span class="w">
</span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">555</span><span class="w">
</span><span class="n">storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Scom</span><span class="o">.</span><span class="n">get_storage</span><span class="p" data-group-id="4919381792-1">(</span><span class="n">node</span><span class="o">.</span><span class="n">ordering</span><span class="p" data-group-id="4919381792-1">)</span><span class="w">
</span><span class="n">increment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">increment_counter_val</span><span class="p" data-group-id="4919381792-2">(</span><span class="n">key</span><span class="p" data-group-id="4919381792-2">)</span><span class="w">
</span><span class="n">zero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero_counter</span><span class="p" data-group-id="4919381792-3">(</span><span class="n">key</span><span class="p" data-group-id="4919381792-3">)</span><span class="w">

</span><span class="nc">Ccom</span><span class="o">.</span><span class="n">subscribe</span><span class="p" data-group-id="4919381792-4">(</span><span class="n">node</span><span class="o">.</span><span class="n">executor</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p" data-group-id="4919381792-5">(</span><span class="p" data-group-id="4919381792-5">)</span><span class="p" data-group-id="4919381792-4">)</span><span class="w">
</span><span class="nc">Mcom</span><span class="o">.</span><span class="n">hard_reset</span><span class="p" data-group-id="4919381792-6">(</span><span class="n">node</span><span class="o">.</span><span class="n">mempool</span><span class="p" data-group-id="4919381792-6">)</span><span class="w">

</span><span class="n">pid_zero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Mcom</span><span class="o">.</span><span class="n">tx</span><span class="p" data-group-id="4919381792-7">(</span><span class="n">node</span><span class="o">.</span><span class="n">mempool</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p" data-group-id="4919381792-7">)</span><span class="o">.</span><span class="n">pid</span><span class="w">

</span><span class="nc">Mcom</span><span class="o">.</span><span class="n">execute</span><span class="p" data-group-id="4919381792-8">(</span><span class="n">node</span><span class="o">.</span><span class="n">mempool</span><span class="p" data-group-id="4919381792-8">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="9536244821-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="9536244821-1">}</span></code></pre><p>Further since the data is live, we can use tools like <code class="inline">:observer</code> to
view the processes, and see general state dumping commands.</p><p>For databases I've found that <a href="Anoma.Mnesia.html"><code class="inline">Anoma.Mnesia</code></a> is a good tool along with
<code class="inline">:observer</code> for seeing what is currently in database table.</p>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="observer.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Observer
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="testing.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Testing
        </span>
      </a>

  </div>
</div>
      <footer class="footer">
        <p>

          <span class="line">
            <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
              Search HexDocs
            </button>

              <a href="Anoma.epub" title="ePub version">
                Download ePub version
              </a>

          </span>
        </p>

        <p class="built-using">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.31.0) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</main>
</div>

<script src="https://cdn.jsdelivr.net/npm/mermaid@10.7.0/dist/mermaid.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
mermaid.initialize({
  startOnLoad: false,
  theme: document.body.className.includes("dark") ? "dark" : "default"
});
let id = 0;
for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
  const preEl = codeEl.parentElement;
  const graphDefinition = codeEl.textContent;
  const graphEl = document.createElement("div");
  const graphId = "mermaid-graph-" + id++;
  mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
    graphEl.innerHTML = svg;
    bindFunctions?.(graphEl);
    preEl.insertAdjacentElement("afterend", graphEl);
    preEl.remove();
  });
}
});
</script>
<script src="https://cdn.jsdelivr.net/npm/vega@5.20.2"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5.1.1"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6.18.2"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
for (const codeEl of document.querySelectorAll("pre code.vega-lite")) {
  try {
    const preEl = codeEl.parentElement;
    const spec = JSON.parse(codeEl.textContent);
    const plotEl = document.createElement("div");
    preEl.insertAdjacentElement("afterend", plotEl);
    vegaEmbed(plotEl, spec);
    preEl.remove();
  } catch (error) {
    console.log("Failed to render Vega-Lite plot: " + error)
  }
}
});
</script>

  </body>
</html>
